import numpy as np
import math

#-------------------------------------------------------------------------
'''
    Problem 3: face recognition 
    In this problem, you will use PCA to perform face recogition in a face image dataset.
    We assume you have already passed the unit tests in problem3.py. There will be a file named "face_pca.npy" in your folder.
    This file contains a numpy matrix of shape (400,20), which is the reduced dimsions for the 400 face images.
    We will need to use this file in this problem.
    You could test the correctness of your code by typing `nosetests test4.py` in the terminal.

    Notations:
            ---------- input data ------------------------
            n: the number of face images, an integer scalar. (n = 400)
            p: the number of pixels in each image, an integer scalar. (p= 4096)
            c: the number of classes (persons), an integer scalar. (c = 40)
            k: the number of dimensions to reduce to, an integer scalar.
            Xp: the feature matrix with reduced dimensions, a numpy float matrix of shape n by k. (400 by k) 
            ----------------------------------------------
'''

#--------------------------
def compute_distance(Xp, q):
    '''
        Compute the Euclidean distance between an query image and all the images in an image dataset.  
        Intput:
            Xp: the projected feature matrix, a float numpy matrix of shape (400, k). 
            q:  a projected features of a query face image. a numpy vector of shape (1, k). 
        Output:
            d: distances between the query image and all the images in Xp. A numpy vector of shape (400,1), where each element i, is the Euclidean distance between i-th image in X and the query image.
    '''
    #########################################
    ## INSERT YOUR CODE HERE

    d = np.array([np.linalg.norm(i - q) for i in Xp])

    #########################################
    return d


#--------------------------
def face_recognition(Xp,q):
    '''
        Compute the most similar faces to the query face (id) from all the images in an image dataset.  
        We will use one image from olivetti face dataset as the query and search for similar faces to the query.
        Intput:
            Xp: the projected feature matrix, a float numpy matrix of shape (400, k). 
            q:  a projected features of a query face image. a numpy vector of shape (1, k). 
        Output:
            ids: the ranked ids of similar face images to the query image.
    '''
    #########################################
    ## INSERT YOUR CODE HERE


    dist = compute_distance(Xp,q)

    dist_inds = dist.argsort()
    dist_sorted = dist[dist_inds[::-1]]
    Xp_sorted = Xp[dist_inds[::-1]] # sorted according to dist
    ids = np.array([np.where((Xp == i).all(1))[0][0] for i in Xp_sorted])
    ids = ids[::-1]
    
    #########################################
    return ids




